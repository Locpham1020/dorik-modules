/**
 * CONFIG MODULE - Centralized configuration
 * URL: https://yourname.github.io/dorik-modules/config.min.js
 */

window.DorikConfig = (function() {
  'use strict';

  // === MAIN CONFIGURATION ===
  const CONFIG = {
    GOOGLE_SCRIPT_URL: 'https://script.google.com/macros/s/AKfycbylfd_DbjRrq90t0jIDPnjx523WhVzXxF9WtajANBLWyVqqZDqZhKu8z6_GOZ6rf9jTQw/exec',
    TALLY_FORM_ID: '31xoq1',
    
    // Firebase Config
    FIREBASE: {
      apiKey: "AIzaSyAd8r4x0ieTiRmD3LA-qbxGtK536zmIols",
      authDomain: "dorik-product-data.firebaseapp.com",
      databaseURL: "https://dorik-product-data-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "dorik-product-data",
      storageBucket: "dorik-product-data.firebasestorage.app",
      messagingSenderId: "452668101268",
      appId: "1:452668101268:web:4690908e5d1896de38da81",
      measurementId: "G-CETXWY9NCM"
    },
    
    // Performance Settings
    PERFORMANCE: {
      VIEWPORT_MARGIN: '100px',
      BATCH_SIZE: 30,
      FIREBASE_TIMEOUT: 5000,
      FIREBASE_RETRY_ATTEMPTS: 3,
      FIREBASE_RETRY_DELAY: 1000,
      SCROLL_DEBOUNCE: 100,
      PRELOAD_NEXT_ONLY: true
    },
    
    // Cache Settings
    CACHE: {
      MAX_PRODUCT_CACHE: 100,
      MAX_IMAGE_CACHE: 200,
      MAX_MEMORY_MB: 50,
      CLEANUP_INTERVAL: 180000
    },
    
    // CDN URLs
    CDN: {
      LIGHTGALLERY_CSS: 'https://cdnjs.cloudflare.com/ajax/libs/lightgallery/2.7.1/css/lightgallery.min.css',
      LIGHTGALLERY_THUMB_CSS: 'https://cdnjs.cloudflare.com/ajax/libs/lightgallery/2.7.1/css/lg-thumbnail.min.css',
      LIGHTGALLERY_JS: 'https://cdnjs.cloudflare.com/ajax/libs/lightgallery/2.7.1/lightgallery.min.js',
      LIGHTGALLERY_THUMB_JS: 'https://cdnjs.cloudflare.com/ajax/libs/lightgallery/2.7.1/plugins/thumbnail/lg-thumbnail.min.js',
      TALLY_EMBED: 'https://tally.so/widgets/embed.js'
    }
  };

  // === UTILITY FUNCTIONS ===
  const Utils = {
    // Device Detection
    getDeviceInfo() {
      const width = window.innerWidth;
      const height = window.innerHeight;
      const userAgent = navigator.userAgent.toLowerCase();
      const platform = navigator.platform?.toLowerCase() || '';
      
      const isMobile = /android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(userAgent) || 
                       width <= 768 || 
                       'ontouchstart' in window;
      const isTablet = (width > 768 && width <= 1024) || /ipad/i.test(userAgent);
      
      let deviceType = 'desktop';
      if (isMobile && width < 768) deviceType = 'mobile';
      else if (isTablet) deviceType = 'tablet';
      else if (width > 1024 && width <= 1440) deviceType = 'laptop';
      
      const connection = navigator.connection || navigator.mozConnection || navigator.webkitConnection;
      const effectiveType = connection?.effectiveType || '4g';
      const isSlowConnection = ['slow-2g', '2g', '3g'].includes(effectiveType);
      
      let os = 'Unknown';
      if (/iphone/i.test(userAgent)) os = 'iOS';
      else if (/ipad/i.test(userAgent)) os = 'iPadOS';
      else if (/android/i.test(userAgent)) os = 'Android';
      else if (/windows/i.test(userAgent)) os = 'Windows';
      else if (/macintosh|mac os x/i.test(userAgent)) os = 'macOS';
      else if (/linux/i.test(userAgent) && !/android/i.test(userAgent)) os = 'Linux';
      else if (/cros/i.test(userAgent)) os = 'ChromeOS';
      else if (platform.includes('win')) os = 'Windows';
      else if (platform.includes('mac')) os = 'macOS';
      else if (platform.includes('linux')) os = 'Linux';
      else if (isMobile) {
        os = width <= 414 && height <= 896 ? 'iOS' : 'Android';
      }
      
      if (os === 'Unknown') {
        os = isMobile ? 'Mobile' : 'Desktop';
      }
      
      return {
        device: deviceType,
        os: os,
        screenWidth: width,
        screenHeight: height,
        userAgent: navigator.userAgent,
        platform: navigator.platform || '',
        isMobile: isMobile,
        isTablet: isTablet,
        isSlowConnection: isSlowConnection,
        effectiveType: effectiveType,
        isHighPerf: !isMobile && !isSlowConnection && width > 1024
      };
    },

    // Get Affiliate ID
    getAffiliateId() {
      const urlParams = new URLSearchParams(window.location.search);
      return urlParams.get('aff') || urlParams.get('ref') || urlParams.get('aff_id') || 'direct';
    },

    // Find Container ID
    findContainerId(element) {
      let container = element;
      while (container && !container.id) {
        container = container.parentElement;
        if (!container) break;
      }
      return container?.id || null;
    },

    // Debug Logger
    log(...args) {
      if (CONFIG.DEBUG) {
        console.log('[Dorik]', ...args);
      }
    },

    // Generate Optimized Thumbnail
    generateOptimizedThumb(imgUrl) {
      if (!imgUrl) return imgUrl;
      
      // Optimize for Cloudinary
      if (imgUrl.includes('cloudinary.com') && imgUrl.includes('/upload/')) {
        return imgUrl.replace('/upload/', '/upload/w_120,h_120,c_fill,q_auto,f_auto/');
      }
      
      return imgUrl;
    }
  };

  // === PUBLIC API ===
  return {
    CONFIG,
    Utils,
    
    // Get specific config section
    get(section) {
      return CONFIG[section] || null;
    },
    
    // Update config (for testing)
    set(section, value) {
      if (CONFIG[section]) {
        CONFIG[section] = { ...CONFIG[section], ...value };
      }
    },
    
    // Get all config
    getAll() {
      return CONFIG;
    }
  };

})();
